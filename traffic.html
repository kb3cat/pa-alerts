<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PA 511 Status Board (POC)</title>

<style>
:root{
  --bg:#0f0f10;
  --panel:#171718;
  --panel2:#1d1d1f;
  --border:#2a2a2d;
  --text:#e9e9ea;
  --muted:#a7a7aa;
  --orange:#ffb000;
  --red:#ff2b2b;
  --blue:#00bfff;
  --yellow:#ffe600;
  --green:#29d36a;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family: Arial, Helvetica, sans-serif;
}

/* HEADER */

.topbar{
  background:#222;
  border-bottom:2px solid var(--border);
  padding:12px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.title{
  font-size:22px;
  font-weight:700;
}

.subtitle{
  color:var(--muted);
  font-size:13px;
}

/* ROWS */

.grid{
  padding:10px;
}

.row{
  background:var(--panel2);
  border:1px solid var(--border);
  border-radius:6px;
  margin-bottom:12px;
  padding:10px 12px;
}

/* PANEL TITLES */

.paneltitle{
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid var(--border);
  padding-bottom:8px;
  margin-bottom:8px;
}

.paneltitle .name{
  font-size:22px;
  font-weight:900;
  color:var(--orange);
}

.paneltitle .count{
  font-size:18px;
  color:var(--muted);
}

/* ITEMS */

.items{
  max-height:45vh;
  overflow:auto;
}

.item{
  padding:10px;
  margin:8px 0;
  background:#141415;
  border:1px solid #232326;
  border-left:7px solid var(--red);
  border-radius:6px;
  font-size:15px;
  line-height:1.25;
}

.speed .item{ border-left-color: var(--blue); }
.vehicle .item{ border-left-color: var(--yellow); }

/* FOOTER */

.footer{
  position:fixed;
  bottom:8px;
  right:12px;
  color:var(--muted);
  font-size:12px;
  background:rgba(0,0,0,.25);
  padding:6px 10px;
  border:1px solid rgba(255,255,255,.08);
  border-radius:999px;
}
</style>
</head>

<body>

<div class="topbar">
  <div class="title">PA 511 Status Board</div>
  <div class="subtitle" id="statusline">Loading…</div>
</div>

<div class="grid">

  <div class="row closures">
    <div class="paneltitle">
      <div class="name">Closures</div>
      <div class="count" id="closuresCount">—</div>
    </div>
    <div class="items" id="closuresList"></div>
  </div>

  <div class="row speed">
    <div class="paneltitle">
      <div class="name">Speed Restrictions</div>
      <div class="count" id="speedCount">—</div>
    </div>
    <div class="items" id="speedList"></div>
  </div>

  <div class="row vehicle">
    <div class="paneltitle">
      <div class="name">Vehicle Restrictions</div>
      <div class="count" id="vehicleCount">—</div>
    </div>
    <div class="items" id="vehicleList"></div>
  </div>

</div>

<div class="footer" id="updated">Last Updated: —</div>

<script>
const REFRESH_MS = 60000;

const ROAD_FILE = "road_conditions.json";
const RESTR_FILE = "restrictions.json";

function candidatePaths(filename) {
  const here = new URL(".", window.location.href);
  const parts = location.pathname.split("/").filter(Boolean);
  const repoBase = parts.length ? `/${parts[0]}/` : "/";

  return [
    new URL(`data/${filename}`, here).toString(),
    new URL(`../data/${filename}`, here).toString(),
    new URL(`${repoBase}data/${filename}`, window.location.origin).toString()
  ];
}

async function fetchFirstWorkingJson(filename) {
  for (const p of candidatePaths(filename)) {
    try {
      const r = await fetch(p, { cache:"no-store" });
      if (!r.ok) continue;
      return await r.json();
    } catch {}
  }
  throw new Error("JSON not found");
}

function normalizeRows(rows) {
  return (rows || [])
    .map(r => Array.isArray(r) ? r.join(" | ") : r)
    .filter(Boolean);
}

function render(id, items, emptyColor){
  const el = document.getElementById(id);
  el.innerHTML = "";

  if(!items.length){
    const div=document.createElement("div");
    div.className="item";
    div.style.borderLeftColor="var(--green)";
    div.textContent="None currently reported";
    el.appendChild(div);
    return;
  }

  items.forEach(i=>{
    const div=document.createElement("div");
    div.className="item";
    div.textContent=i;
    el.appendChild(div);
  });
}

async function loadBoard(){
  try{
    const road = await fetchFirstWorkingJson(ROAD_FILE);
    const restr = await fetchFirstWorkingJson(RESTR_FILE);

    const roadRows = normalizeRows(road.rows);
    const restrRows = normalizeRows(restr.rows);

    const closures = roadRows.filter(t=>/closed|closure/i.test(t));
    const speed = restrRows.filter(t=>/mph|speed/i.test(t));
    const vehicle = restrRows.filter(t=>/tier|restriction|vehicle|truck|permit/i.test(t) && !/mph/i.test(t));

    document.getElementById("closuresCount").textContent=closures.length;
    document.getElementById("speedCount").textContent=speed.length;
    document.getElementById("vehicleCount").textContent=vehicle.length;

    render("closuresList",closures);
    render("speedList",speed);
    render("vehicleList",vehicle);

    document.getElementById("updated").textContent =
      "Last Updated: "+new Date().toLocaleString();

    document.getElementById("statusline").textContent="OK";

  }catch(e){
    console.error(e);
    document.getElementById("statusline").textContent="ERROR loading data";
  }
}

loadBoard();
setInterval(loadBoard,REFRESH_MS);
</script>

</body>
</html>

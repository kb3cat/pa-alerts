<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PA 511 Status Board</title>

<style>
body {
    margin:0;
    background:#111;
    font-family:Arial, Helvetica, sans-serif;
    color:white;
}

.header {
    padding:15px;
    font-size:28px;
    background:#222;
    border-bottom:2px solid #333;
}

.row {
    display:flex;
    height:30vh;
    border-bottom:2px solid #222;
}

.panel {
    flex:1;
    padding:15px;
    overflow:auto;
}

.title {
    font-size:24px;
    margin-bottom:10px;
    color:#ffa500;
}

.item {
    padding:8px;
    margin:6px 0;
    background:#1a1a1a;
    border-left:5px solid red;
    font-size:16px;
}

.speed .item {
    border-left-color:#00bfff;
}

.travel .item {
    border-left-color:#ffff00;
    color:#fff;
}

.timestamp {
    position:fixed;
    bottom:5px;
    right:10px;
    font-size:12px;
    color:#aaa;
}
</style>
</head>

<body>

<div class="header">Pennsylvania 511 Status Board (POC)</div>

<!-- Closures -->
<div class="row">
    <div class="panel closures">
        <div class="title">Road Closures</div>
        <div id="closures"></div>
    </div>
</div>

<!-- Speed Restrictions -->
<div class="row speed">
    <div class="panel">
        <div class="title">Speed Restrictions</div>
        <div id="speed"></div>
    </div>
</div>

<!-- Travel Restrictions -->
<div class="row travel">
    <div class="panel">
        <div class="title">Travel Restrictions</div>
        <div id="travel"></div>
    </div>
</div>

<div class="timestamp" id="updated"></div>

<script>
async function loadData() {
    try {
        const data = await fetch('data/road_conditions.json')
            .then(r => r.json());

        const rows = data.rows || [];

        const closures = [];
        const speed = [];
        const travel = [];

        rows.forEach(r => {
            const text = r.join(" ");

            if (/closed/i.test(text))
                closures.push(text);

            else if (/mph|speed/i.test(text))
                speed.push(text);

            else if (/restriction|tier|vehicle/i.test(text))
                travel.push(text);
        });

        render("closures", closures);
        render("speed", speed);
        render("travel", travel);

        document.getElementById("updated").innerText =
            "Last Updated: " + new Date().toLocaleString();

    } catch(e) {
        console.error(e);
    }
}

function render(id, items) {
    const el = document.getElementById(id);
    el.innerHTML = "";

    if (!items.length) {
        el.innerHTML = "<div class='item'>None currently reported</div>";
        return;
    }

    items.forEach(i => {
        const div = document.createElement("div");
        div.className = "item";
        div.textContent = i;
        el.appendChild(div);
    });
}

loadData();
setInterval(loadData, 60000);
</script>

</body>
</html>

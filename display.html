<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PA Watches, Warnings & Advisories â€” SA Display</title>

<style>
  :root{
    color-scheme: light;

    --bg:#ffffff;
    --text:#111111;
    --muted:#555555;

    --border:#333333;
    --soft:#dddddd;
    --head:#f0f0f0;
    --panelBg:#ffffff;

    --warn:#8b1a1a;
    --watch:#b45309;
    --adv:#1d4ed8;
  }

  html[data-theme="dark"]{
    color-scheme: dark;

    --bg:#0b0f17;
    --text:#e8eefc;
    --muted:#a8b3c7;

    --border:#445069;
    --soft:#2b3344;
    --head:#151c2b;
    --panelBg:#0f1626;
  }

  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:var(--bg);
    color:var(--text);
  }

  .wrap{
    height:100vh;
    display:grid;
    grid-template-rows:auto 1fr;
    gap:8px;
    padding:8px;
    box-sizing:border-box;
  }

  .topbar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    padding:8px 12px;
    border:1px solid var(--border);
    border-radius:10px;
    background:var(--panelBg);
  }

  .title{ font-weight:700; }

  .meta{
    display:flex;
    gap:10px;
    align-items:center;
    color:var(--muted);
    font-size:.95em;
  }

  .btn{
    border:1px solid var(--border);
    background:transparent;
    color:var(--text);
    padding:6px 10px;
    border-radius:8px;
    cursor:pointer;
    font:inherit;
  }

  .grid{
    display:grid;
    grid-template-columns:45% 55%;
    gap:8px;
    height:100%;
    min-height:0;
  }

  .panel{
    border:1px solid var(--border);
    border-radius:10px;
    overflow:hidden;
    background:var(--panelBg);
    display:flex;
    flex-direction:column;
    min-height:0;
  }

  .panel h2{
    margin:0;
    padding:8px 10px;
    background:var(--head);
    border-bottom:1px solid var(--border);
    font-size:1em;
  }

  .panel .body{
    padding:8px 10px;
    overflow:auto;
    min-height:0;
  }

  /* SUMMARY TABLE */
  table{
    border-collapse:collapse;
    width:100%;
    font-size:.95em;
  }

  th, td{
    border:1px solid var(--border);
    padding:6px 8px;
    vertical-align:top;
  }

  th{
    background:var(--head);
    text-align:left;
  }

  .typeBar{
    border-left:6px solid #999;
    padding-left:8px;
  }
  .typeBar.warn{ border-left-color: var(--warn); }
  .typeBar.watch{ border-left-color: var(--watch); }
  .typeBar.adv{ border-left-color: var(--adv); }

  /* MAP + RADAR COMBINED */
  .mapRadar{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:8px;
    height:100%;
  }

  .mapWrap img{
    width:100%;
    height:100%;
    object-fit:contain;
  }

  .radar iframe{
    width:100%;
    height:100%;
    border:0;
    pointer-events:none;
  }
</style>
</head>

<body>
<div class="wrap">

  <div class="topbar">
    <div class="title">Pennsylvania Watches, Warnings & Advisories</div>
    <div class="meta">
      <span id="updated">Loadingâ€¦</span>
      <button class="btn" id="themeBtn">ðŸŒ“</button>
      <button class="btn" id="refreshBtn">Refresh</button>
    </div>
  </div>

  <div class="grid">

    <!-- SUMMARY -->
    <div class="panel">
      <h2>Summary</h2>
      <div class="body" id="summary">Loadingâ€¦</div>
    </div>

    <!-- MAP + RADAR -->
    <div class="panel">
      <h2>PA Alert Map & Radar</h2>
      <div class="body mapRadar">
        <div class="mapWrap">
          <img
            id="paMap"
            src="https://www.weather.gov/images/crh/noc/wwa_pa.png"
            alt="PA Watches, Warnings, and Advisories Map"
          />
        </div>
        <div class="radar">
          <iframe
            src="https://radar.weather.gov/region/CONUS/standard"
            loading="lazy"
            title="NWS Radar"
          ></iframe>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
/* THEME */
function applyTheme(t){
  document.documentElement.setAttribute("data-theme", t);
  localStorage.setItem("sa_theme", t);
}
applyTheme(localStorage.getItem("sa_theme") || "light");

document.getElementById("themeBtn").onclick = () => {
  const cur = document.documentElement.getAttribute("data-theme");
  applyTheme(cur === "dark" ? "light" : "dark");
};

/* HELPERS */
function classify(evt){
  evt = (evt || "").toLowerCase();
  if(evt.includes("warning")) return "warn";
  if(evt.includes("watch")) return "watch";
  return "adv";
}

function fmtTime(iso){
  if(!iso) return "â€”";
  const d = new Date(iso);
  return d.toLocaleString([], {
    month:"2-digit", day:"2-digit", year:"2-digit",
    hour:"2-digit", minute:"2-digit"
  });
}

/* LOAD DATA */
async function loadAlerts(){
  const summary = document.getElementById("summary");
  const updated = document.getElementById("updated");

  updated.textContent = "Updatingâ€¦";

  let data;
  try{
    const r = await fetch("https://api.weather.gov/alerts/active?area=PA", { cache:"no-store" });
    data = await r.json();
  }catch{
    summary.textContent = "Unable to load alert data.";
    updated.textContent = "Error";
    return;
  }

  const feats = data.features || [];

  updated.textContent = "Updated " + new Date().toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});

  if(!feats.length){
    summary.textContent = "No active watches, warnings, or advisories.";
    return;
  }

  let rows = "";
  feats.forEach(f=>{
    const p = f.properties || {};
    const cls = classify(p.event);

    rows += `
      <tr>
        <td>
          <div class="typeBar ${cls}">
            <strong>${p.event || "â€”"}</strong>
          </div>
        </td>
        <td>${p.areaDesc || "â€”"}</td>
        <td>${fmtTime(p.expires || p.ends)}</td>
      </tr>
    `;
  });

  summary.innerHTML = `
    <table aria-label="Summary table">
      <thead>
        <tr>
          <th>Type</th>
          <th>Locations</th>
          <th>Expires</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

/* MAP REFRESH */
function refreshMap(){
  const img = document.getElementById("paMap");
  img.src = "https://www.weather.gov/images/crh/noc/wwa_pa.png?_ts=" + Date.now();
}

document.getElementById("refreshBtn").onclick = () => {
  refreshMap();
  loadAlerts();
};

refreshMap();
loadAlerts();
setInterval(() => {
  refreshMap();
  loadAlerts();
}, 300000);
</script>

</body>
</html>
